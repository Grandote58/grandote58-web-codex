![Recurso 2foto001](C:\Users\juanc\OneDrive\Escritorio\JavascripWeb\SimulacionPolea\2x\Recurso 2foto001.png)

## **üß† Paso 3. L√≥gica (JavaScript): constantes y ‚Äúestado‚Äù**

### **1) Constantes f√≠sicas**

```javascript
const g = 9.81; // m/s^2
```

- Valor de la gravedad que usar√°s en los c√°lculos de fuerza. Es constante (no cambia durante la simulaci√≥n).

### **2) Referencias a la interfaz (DOM)**

```javascript
const mass = document.getElementById('mass');
const mu = document.getElementById('mu');
const force = document.getElementById('force');
const pullBtn = document.getElementById('pullBtn');
const resetBtn = document.getElementById('resetBtn');

const massLabel = document.getElementById('massLabel');
const muLabel = document.getElementById('muLabel');
const forceLabel = document.getElementById('forceLabel');

const needSpan = document.getElementById('needSpan');
const statusSpan = document.getElementById('statusSpan');
const heightSpan = document.getElementById('heightSpan');
```

- ‚ÄúAgarra‚Äù los **sliders**, los **botones** y los **numeritos** que muestran resultados, para poder leer/escribir sus valores desde JS.

### **3) Referencias a la escena (SVG)**

```javascript
const ropeRight = document.getElementById('ropeRight');
const hook = document.getElementById('hook');
const weight = document.getElementById('weight');
```

- Son las partes del dibujo que **cambiar√°s** (posici√≥n de la cuerda, gancho y bloque).

### **4) Estado de la simulaci√≥n**

```javascript
let y0 = 310;   // posici√≥n vertical inicial del peso (px)
let y = y0;     // posici√≥n actual
let height = 0; // altura subida en metros
const PX_PER_M = 100; // 100 px = 1 m (regla de conversi√≥n)
let animId = null;    // id de la animaci√≥n (para iniciar/detener)
```

- El SVG usa **p√≠xeles**. Para dar sentido f√≠sico, decides que **100 px valen 1 m**.
- `animId` se usa con `requestAnimationFrame` para controlar la animaci√≥n.

### **5) Fuerza necesaria (modelo f√≠sico simplificado)**

```javascript
function fuerzaNecesaria(m, mu){
  // Polea fija con rozamiento:
  // F_nec ‚âà m * g * (1 + mu)
  return m * g * (1 + mu);
}
```

- Si no hubiera p√©rdidas: 
   $$
   F = m ‚ãÖ g
   $$
   

- Con rozamiento (p√©rdidas), multiplicas por

$$
(1 + Œº)
$$

### **6) Refrescar etiquetas de la UI**

```javascript
function actualizarEtiquetas(){
  massLabel.textContent = mass.value;
  muLabel.textContent = (mu.value/100).toFixed(2);
  forceLabel.textContent = force.value;

  const m = Number(mass.value);
  const muVal = Number(mu.value)/100;
  const Fnec = fuerzaNecesaria(m, muVal);

  needSpan.textContent = Fnec.toFixed(1);
}
```

- Pasa valores de los sliders a los `<span>`.
- Convierte textos a n√∫mero con `Number(...)`.
- Calcula y muestra la **Fuerza necesaria** con 1 decimal.

### **7) Escuchar cambios en los controles**

```javascript
[mass, mu, force].forEach(ctrl => {
  ctrl.addEventListener('input', () => {
    actualizarEtiquetas();
    actualizarEstado();
  });
});
```

- Cada vez que el estudiante mueve un slider, se **recalcula** y se **actualiza** lo visible.

### **8) Mover el peso y ajustar la cuerda**

```javascript
function setPesoY(newY){
  // Limita el recorrido (para que no ‚Äúatraviese‚Äù el techo o el suelo)
  y = Math.min(Math.max(newY, 120), y0);

  // Mueve gancho y bloque
  hook.setAttribute('y', y);
  weight.setAttribute('y', y + 10);

  // Alarga/acorta la cuerda vertical
  ropeRight.setAttribute('y2', y);

  // Calcula altura real en metros
  height = (y0 - y) / PX_PER_M;
  heightSpan.textContent = height.toFixed(2);

  // Efecto visual cuando est√° subiendo
  weight.classList.toggle('rising', y < y0);
}
```

- **L√≠mites:** 120 px (arriba) y 310 px (abajo).
- Mantiene **coherencia**: si el bloque sube, tambi√©n sube el extremo de la cuerda.
- Actualiza la **altura** (metros) que se muestra al usuario.
- Pone o quita la clase `.rising` para la mini-animaci√≥n.

### **9) Mensaje de estado (¬øalcanza la fuerza?)**

```javascript
function actualizarEstado(){
  const m = Number(mass.value);
  const muVal = Number(mu.value)/100;
  const Fnec = fuerzaNecesaria(m, muVal);
  const Fap = Number(force.value);

  if(Fap >= Fnec){
    statusSpan.textContent = '¬°Superas la fuerza necesaria! Sube.';
    statusSpan.className = 'ok';
  } else {
    statusSpan.textContent = 'Todav√≠a no alcanza. Ajusta los controles.';
    statusSpan.className = 'fail';
  }
}
```

- Compara **F aplicada** con **F necesaria** y muestra un mensaje en **verde** o **rojo**.

### **10) Bucle de animaci√≥n (subir mientras tiras)**

```javascript
function step(){
  const m = Number(mass.value);
  const muVal = Number(mu.value)/100;
  const Fnec = fuerzaNecesaria(m, muVal);
  const Fap = Number(force.value);

  if(Fap >= Fnec && y > 120){
    // M√°s ‚Äúexceso‚Äù de fuerza ‚Üí m√°s r√°pido.
    const ratio = Math.min((Fap - Fnec) / (m*g), 1); // escala 0..1
    const dy = 1 + ratio * 3; // p√≠xeles por cuadro
    setPesoY(y - dy);
  }
  animId = requestAnimationFrame(step);
}
```

- `requestAnimationFrame` llama a `step()` ~60 veces por segundo.
- La **velocidad** depende de cu√°nto sobrepasas la fuerza necesaria.

### **11) Soporte mouse y pantallas t√°ctiles**

```javascript
function iniciarAnimacion() {
  if(!animId) animId = requestAnimationFrame(step);
}
function detenerAnimacion() {
  if(animId){ cancelAnimationFrame(animId); animId = null; }
}
pullBtn.addEventListener('mousedown', iniciarAnimacion);
pullBtn.addEventListener('touchstart', iniciarAnimacion);
pullBtn.addEventListener('mouseup', detenerAnimacion);
pullBtn.addEventListener('touchend', detenerAnimacion);
document.addEventListener('mouseup', detenerAnimacion);
document.addEventListener('touchend', detenerAnimacion);
```

- Al **presionar** el bot√≥n ‚ÄúTirar‚Äù (mouse o dedo) inicia la animaci√≥n.
- Al **soltar**, la detiene.
- Tambi√©n escucha el documento completo por si el cursor sale del bot√≥n.

### **12) Bot√≥n Reiniciar**

```javascript
resetBtn.addEventListener('click', () => {
  if(animId){ cancelAnimationFrame(animId); animId = null; }
  setPesoY(y0);
  force.value = 0;
  actualizarEtiquetas();
  actualizarEstado();
});
```

- Para todo, baja el bloque y deja la fuerza aplicada en 0.

### **13) Inicializaci√≥n al cargar**

```javascript
setPesoY(y0);
actualizarEtiquetas();
actualizarEstado();
```

- Coloca todo en un estado **coherente** antes de empezar.

## üß™ Modificaciones que pueden hacer los estudiantes

1. **Gravedad variable** (comparar Tierra/Luna/Marte)

   ```javascript
   // Agregar un select en HTML y leerlo aqu√≠
   const gSelect = document.getElementById('gSelect');
   gSelect.addEventListener('change', () => {
     const map = { tierra: 9.81, luna: 1.62, marte: 3.71 };
     g = map[gSelect.value];            // cambia g
     actualizarEtiquetas();
     actualizarEstado();
   });
   ```

   > **Requiere convertir `const g` en `let g`.**

2. **Ventaja mec√°nica** (polea m√≥vil)

    A√±ade un control `vm` (1 = fija, 2 = una m√≥vil, etc.) y modifica:

   ```javascript
   function fuerzaNecesaria(m, mu){
     const vm = Number(document.getElementById('vm').value || 1);
     return (m * g * (1 + mu)) / vm;
   }
   ```

   > **Ver√°n que al duplicar la cuerda de soporte, la fuerza baja casi a la mitad.**

3. **Modelo con aceleraci√≥n real**

   En lugar de velocidad proporcional, usa 
   $$
   a = (Faplicada ‚àí Fnecesaria) / m
   $$
    y actualiza **velocidad** y **posici√≥n**:

   ```javascript
   let v = 0; // m/s
   function stepF√≠sica(timestamp){
     const m = Number(mass.value);
     const muVal = Number(mu.value)/100;
     const Fnec = fuerzaNecesaria(m, muVal);
     const Fap = Number(force.value);
   
     const dt = 1/60; // segundos aprox
     const a = (Fap - Fnec) / m; // m/s^2 (puede ser negativa)
     if(y > 120 || v < 0){       // no subir m√°s del tope
       v += a * dt;
       const dy = (v * dt) * PX_PER_M; // m ‚Üí px
       setPesoY(y - dy);
     }
     animId = requestAnimationFrame(stepF√≠sica);
   }
   ```

   > **Esto se acerca m√°s a la f√≠sica real (aceleraci√≥n/velocidad).**

4. **Medici√≥n de trabajo y potencia**

   Muestra 
   $$
   W = F ‚ãÖ Œîh
   $$
   y
   $$
   ùëÉ = ùëä / ùë°
   $$
   mientras sube.  Esto refuerza **energ√≠a** y **tiempo**.

5. **Historial y gr√°ficas**

   Guarda los pares (t,h) o (F,h) en un arreglo y dibuja una gr√°fica simple en `<canvas>`.

6. **Accesibilidad y controles extra**

   - Tecla **Espacio** para ‚Äútirar‚Äù.
   - Bot√≥n **Auto** para mantener fuerza aplicada constante sin tener presionado.

7. **Personalizaci√≥n visual**

   Cambia colores (`:root`), grosor de la cuerda, agrega un ‚Äúsonidito‚Äù cuando llega al tope, o un ‚Äúpop‚Äù en las flechas.

## üß™ C√≥digo Completo

```javascript
// Constantes f√≠sicas
const g = 9.81; // m/s^2

// Elementos de UI
const mass = document.getElementById('mass');
const mu = document.getElementById('mu');
const force = document.getElementById('force');
const pullBtn = document.getElementById('pullBtn');
const resetBtn = document.getElementById('resetBtn');

const massLabel = document.getElementById('massLabel');
const muLabel = document.getElementById('muLabel');
const forceLabel = document.getElementById('forceLabel');

const needSpan = document.getElementById('needSpan');
const statusSpan = document.getElementById('statusSpan');
const heightSpan = document.getElementById('heightSpan');

// Elementos de escena
const ropeRight = document.getElementById('ropeRight');
const hook = document.getElementById('hook');
const weight = document.getElementById('weight');

// Estado de simulaci√≥n
let y0 = 310;      // y inicial del peso (px, en el SVG)
let y = y0;        // y actual
let height = 0;    // altura subida (m) ‚Äî usaremos 100 px = 1 m
const PX_PER_M = 100;
let animId = null;


function fuerzaNecesaria(m, mu){
  // Modelo simple para polea fija con rozamiento:
  // F_nec ‚âà m*g*(1 + mu)
  return m * g * (1 + mu);
}

function actualizarEtiquetas(){
  massLabel.textContent = mass.value;
  muLabel.textContent = (mu.value/100).toFixed(2);
  forceLabel.textContent = force.value;

  const m = Number(mass.value);
  const muVal = Number(mu.value)/100;
  const Fnec = fuerzaNecesaria(m, muVal);

  needSpan.textContent = Fnec.toFixed(1);
}

[mass, mu, force].forEach(ctrl => {
  ctrl.addEventListener('input', () => {
    actualizarEtiquetas();
    actualizarEstado();
  });
});


function setPesoY(newY){
  // Limita movimiento entre 120 px (arriba) y 310 px (abajo)
  y = Math.min(Math.max(newY, 120), y0);

  // Actualiza gancho y peso
  hook.setAttribute('y', y);
  weight.setAttribute('y', y + 10);

  // Actualiza cuerda vertical (hacia el peso)
  ropeRight.setAttribute('y2', y);

  // Altura real en metros
  height = (y0 - y) / PX_PER_M;
  heightSpan.textContent = height.toFixed(2);

  // flecha decorativa
  weight.classList.toggle('rising', y < y0);
}


function actualizarEstado(){
  const m = Number(mass.value);
  const muVal = Number(mu.value)/100;
  const Fnec = fuerzaNecesaria(m, muVal);
  const Fap = Number(force.value);

  if(Fap >= Fnec){
    statusSpan.textContent = '¬°Superas la fuerza necesaria! Sube.';
    statusSpan.className = 'ok';
  } else {
    statusSpan.textContent = 'Todav√≠a no alcanza. Ajusta los controles.';
    statusSpan.className = 'fail';
  }
}


function step(){
  const m = Number(mass.value);
  const muVal = Number(mu.value)/100;
  const Fnec = fuerzaNecesaria(m, muVal);
  const Fap = Number(force.value);

  if(Fap >= Fnec && y > 120){
    // velocidad proporcional a la ganancia de fuerza (escala suave)
    const ratio = Math.min((Fap - Fnec) / (m*g), 1); // 0..1
    const dy = 1 + ratio * 3; // px por cuadro
    setPesoY(y - dy);
  }
  animId = requestAnimationFrame(step);
}

// Compatibilidad mouse y touch para el bot√≥n "Tirar"
function iniciarAnimacion() {
  if(!animId) animId = requestAnimationFrame(step);
}
function detenerAnimacion() {
  if(animId){ cancelAnimationFrame(animId); animId = null; }
}
pullBtn.addEventListener('mousedown', iniciarAnimacion);
pullBtn.addEventListener('touchstart', iniciarAnimacion);
pullBtn.addEventListener('mouseup', detenerAnimacion);
pullBtn.addEventListener('touchend', detenerAnimacion);
document.addEventListener('mouseup', detenerAnimacion);
document.addEventListener('touchend', detenerAnimacion);


resetBtn.addEventListener('click', () => {
  if(animId){ cancelAnimationFrame(animId); animId = null; }
  setPesoY(y0);
  force.value = 0;
  actualizarEtiquetas();
  actualizarEstado();
});


// Coloca todo en su sitio al cargar
setPesoY(y0);
actualizarEtiquetas();
actualizarEstado();

```



![Recurso 4foto0021](C:\Users\juanc\OneDrive\Escritorio\JavascripWeb\SimulacionPolea\2x\Recurso 4foto0021.png)